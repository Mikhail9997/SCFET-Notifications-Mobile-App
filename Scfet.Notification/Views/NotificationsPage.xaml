<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Scfet.Notification.Views.NotificationsPage"
             xmlns:vm="clr-namespace:Scfet.Notification.ViewModels"
             xmlns:models="clr-namespace:Scfet.Notification.Models"
             xmlns:views="clr-namespace:Scfet.Notification.Views"
             x:DataType="vm:NotificationsViewModel"
             Title="{Binding Title}">
    <Grid>

        <!-- ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹ -->
        <StackLayout HorizontalOptions="Center" 
                         VerticalOptions="Center"
                         IsVisible="{Binding IsStartLoadNotificationsFailed}">

            <Image Source="no_wifi.png" HeightRequest="200" WidthRequest="200" Margin="0,0,0,70"/>
            <Label Text="ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ" FontSize="16"/>
            <Label Text="ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ñƒ" FontSize="16"/>
            <Button Text="ÐŸÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ"
                    Command="{Binding RefreshCommand}"
                    BackgroundColor="#2E86AB"
                    TextColor="White"
                    CornerRadius="5"
                    Margin="0,10,0,0"/>
        </StackLayout>

        <!-- Ð¡Ð¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ -->
        <VerticalStackLayout IsVisible="{Binding IsBusy}"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           Spacing="20">
            <ActivityIndicator IsRunning="True" 
                             Color="#2E86AB"
                             HeightRequest="50"
                             WidthRequest="50" />
            <Label Text="Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹..." 
                               FontSize="16"
                               HorizontalOptions="Center" />
        </VerticalStackLayout>

        <ScrollView IsVisible="{Binding IsStartLoadNotificationsFailed, Converter={StaticResource InverseBoolConverter}}">
            <StackLayout Padding="10,0">

                <!-- ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ -->
                <Grid>

                    <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹ -->
                    <StackLayout IsVisible="{Binding IsBusy, Converter={StaticResource InverseBoolConverter}}"
                             Spacing="20">

                        <!-- Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹-->
                        <Border BackgroundColor="#f0f0f0"
                           Padding="10">

                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="5"/>
                            </Border.StrokeShape>

                            <VerticalStackLayout Spacing="10">
                                <Label Text="Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹:" 
                                   FontSize="14" 
                                   FontAttributes="Bold" />

                                <Picker Title="Ð Ð°Ð·Ð¼ÐµÑ€ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñ‹"
                                    ItemsSource="{Binding PageSizes}"
                                    SelectedItem="{Binding Filter.PageSize}" />

                                <Picker Title="Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐŸÐ¾:"
                                    ItemsSource="{Binding SortByItems}"
                                    SelectedItem="{Binding SelectedSortBy}"
                                    ItemDisplayBinding="{Binding DisplayName}"/>

                                <Picker Title="Ð£Ð¿Ð¾Ñ€ÑÐ´Ð¾Ñ‡Ð¸Ñ‚ÑŒ:" 
                                    ItemsSource="{Binding SortOrderItems}"
                                    SelectedItem="{Binding SelectedSortOrder}"
                                    ItemDisplayBinding="{Binding DisplayName}"/>

                                <Picker Title="Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿ÐµÑ€Ð¸Ð¾Ð´"
                                    ItemsSource="{Binding DateRangeOptions}"
                                    SelectedItem="{Binding SelectedDateRange}"
                                    ItemDisplayBinding="{Binding DisplayName}"/>

                                <Grid ColumnDefinitions="Auto,Auto" 
                                  ColumnSpacing="5"
                                  IsVisible="{Binding ShowCustomDateInput}">
                                    <StackLayout Grid.Column="0" Padding="10">
                                        <Label Text="Ð¡:"/>
                                        <DatePicker Date="{Binding SelectedStartDate}"/>
                                    </StackLayout>
                                    <StackLayout Grid.Column="1" Padding="10">
                                        <Label Text="ÐŸÐ¾:"/>
                                        <DatePicker Date="{Binding SelectedEndDate}"/>
                                    </StackLayout>
                                </Grid>

                                <HorizontalStackLayout Spacing="10">
                                    <Button Text="ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€"
                                        Command="{Binding ApplyFiltersCommand}"
                                        BackgroundColor="#2E86AB"
                                        TextColor="White"
                                        CornerRadius="5"
                                        HorizontalOptions="FillAndExpand"
                                        IsEnabled="{Binding IsPagination, Converter={StaticResource InverseBoolConverter}}"/>

                                    <Button Text="Ð¡Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ"
                                        Command="{Binding ResetFiltersCommand}"
                                        BackgroundColor="#6c757d"
                                        TextColor="White"
                                        CornerRadius="5"
                                        HorizontalOptions="FillAndExpand"
                                        IsEnabled="{Binding IsPagination, Converter={StaticResource InverseBoolConverter}}"/>
                                </HorizontalStackLayout>
                            </VerticalStackLayout>
                        </Border>

                        <CollectionView ItemsSource="{Binding Notifications}"
                                SelectionMode="None">

                            <CollectionView.EmptyView>
                                <VerticalStackLayout HorizontalOptions="Center" 
                                           VerticalOptions="Center"
                                           Spacing="20"
                                           Padding="30">
                                    <Label Text="ðŸ“­" 
                                   FontSize="48" 
                                   HorizontalOptions="Center" />
                                    <Label Text="ÐÐµÑ‚ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹" 
                                   FontSize="18" 
                                   HorizontalOptions="Center" />
                                    <Label Text="Ð—Ð´ÐµÑÑŒ Ð±ÑƒÐ´ÑƒÑ‚ Ð¿Ð¾ÑÐ²Ð»ÑÑ‚ÑŒÑÑ Ð½Ð¾Ð²Ñ‹Ðµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð¾Ñ‚ Ð¿Ñ€ÐµÐ¿Ð¾Ð´Ð°Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð¸ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸" 
                                   FontSize="14" 
                                   TextColor="Gray"
                                   HorizontalOptions="Center"
                                   HorizontalTextAlignment="Center" />
                                </VerticalStackLayout>
                            </CollectionView.EmptyView>

                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="models:Notification">
                                    <Border Padding="15" 
                                         Margin="10,5"
                                         BackgroundColor="{Binding Type, Converter={StaticResource NotificationTypeToColorConverter}}">
                                        <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto"
                                      ColumnDefinitions="*,Auto"
                                      RowSpacing="5">

                                            <Image Grid.Row="0"
                                               Grid.ColumnSpan="2"
                                               HeightRequest="350"
                                               IsVisible="{Binding ImageUrl, Converter={StaticResource StringNotEmptyConverter}}">
                                                <Image.Source>
                                                    <UriImageSource Uri="{Binding ImageUrl}"/>
                                                </Image.Source>
                                            </Image>

                                            <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
                                            <Label Grid.Row="1" 
                                           Grid.Column="0"
                                           Text="{Binding Title}" 
                                           FontSize="16" 
                                           FontAttributes="Bold" />

                                            <!-- Ð”Ð°Ñ‚Ð° -->
                                            <Label Grid.Row="2" 
                                           Grid.Column="1"
                                           Text="{Binding FormattedDate}" 
                                           FontSize="12" 
                                           TextColor="Gray" />

                                            <!-- ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÐµÐ»ÑŒ -->
                                            <Label Grid.Row="3" 
                                           Grid.Column="0"
                                           Text="{Binding SenderName}" 
                                           FontSize="12" 
                                           TextColor="Gray" />

                                            <!-- Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ -->
                                            <Label Grid.Row="4" 
                                           Grid.ColumnSpan="2"
                                           Text="{Binding Message}" 
                                           FontSize="14" 
                                           LineBreakMode="WordWrap" />

                                            <!-- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð¿Ñ€Ð¾Ñ‡Ñ‚ÐµÐ½Ð¸Ñ -->
                                            <Label Grid.Row="5" 
                                           Grid.Column="0"
                                           Text="{Binding IsRead, Converter={StaticResource ReadStatusConverter}}"
                                           FontSize="12" 
                                           TextColor="Gray" />

                                        </Grid>

                                        <Border.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:NotificationsViewModel}}, Path=MarkAsReadCommand}"
                                                                 CommandParameter="{Binding .}" />
                                        </Border.GestureRecognizers>

                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </StackLayout>
                </Grid>

                <!-- Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ -->
                <Grid IsVisible="{Binding IsPaginationEnable}">

                    <!-- Ð¡Ð¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð¿Ð°Ð³Ð¸Ð½Ð°Ñ†Ð¸Ð¸-->
                    <VerticalStackLayout IsVisible="{Binding IsPagination}"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           Spacing="20">
                        <ActivityIndicator IsRunning="True" 
                             Color="#2E86AB"
                             HeightRequest="50"
                             WidthRequest="50" />
                        <Label Text="Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹..." 
                               FontSize="16"
                               HorizontalOptions="Center" />
                    </VerticalStackLayout>

                    <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ ÐµÑ‰Ðµ -->
                    <Grid Margin="0,10,0,0" ColumnDefinitions="*"
                      IsVisible="{Binding IsPagination, Converter={StaticResource InverseBoolConverter}}">

                        <Button Grid.Column="0" 
                            Text="Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ ÐµÑ‰Ðµ" 
                            Command="{Binding LoadNotificationsPaginationCommand}"
                            BackgroundColor="#2E86AB"/>
                    </Grid>
                </Grid>
            </StackLayout>
        </ScrollView>
    </Grid>

</ContentPage>